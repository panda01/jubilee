<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <style>
    body {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }
  </style>

  <div id="chart"></div>

  <script data-main="../../src/require.config.js"
          src="../../../node_modules/requirejs/require.js"></script>
  <script>
    require(["../../src/index"], function (jubilee) {
      var data = {
        series: [
          [
            { x: 1411761450000, y: 41, label: "band"},
            { x: 1411761480000, y: 18, label: "band"},
            { x: 1411761510000, y: 20, label: "band"},
            { x: 1411761540000, y: 17, label: "band"},
            { x: 1411761570000, y: 17, label: "band"}
          ],
          [
            { x: 1411761450000, y: 91, label: "of"},
            { x: 1411761480000, y: 88, label: "of"},
            { x: 1411761510000, y: 100, label: "of"},
            { x: 1411761540000, y: 47, label: "of"},
            { x: 1411761570000, y: 57, label: "of"}
          ],
          [
            { x: 1411761450000, y: 191, label: "brothers"},
            { x: 1411761480000, y: 188, label: "brothers"},
            { x: 1411761510000, y: 105, label: "brothers"},
            { x: 1411761540000, y: 147, label: "brothers"},
            { x: 1411761570000, y: 157, label: "brothers"}
          ],
          [
            { x: 1411761450000, y: -201, label: "yes"},
            { x: 1411761480000, y: -198, label: "yes"},
            { x: 1411761510000, y: -232, label: "yes"},
            { x: 1411761540000, y: -547, label: "yes"},
            { x: 1411761570000, y: -357, label: "yes"}
          ]
        ]
      };

      var color = d3.scale.category10(["band", "of", "brothers", "yes"]);

      var myChart = jubilee.chart.line()
        .height(500)
        .yScale({ nice: true })
        .lines({
          stroke: function (d) { return color(d[0].label); },
          interpolate: "cardinal",
        })
        .circles({
          show: true,
          fill: function (d) { return color(d.label); },
          opacity: 0
        })
        .on("mousemove", function (e, d, i) {
          var parent = d3.select(e.currentTarget);

          var x = d3.mouse(e.currentTarget)[0];
          parent.append("line")
            .attr("class", "mousemove-line")
            .attr("x1", x)
            .attr("x2", x)
            .attr("y1", 500)
            .attr("y2", 0)
            .attr("stroke", "black");

          parent.select("line").remove();
        })
        .on("mouseover", function (e, d, i) {
          d3.event.stopPropagation();
          var val = d3.select(e.target).style("opacity");
          var parent = d3.select(e.currentTarget);
          var pData = parent.datum();
          var rData = d3.merge(pData).filter(function (a, i) {
            return a.x === d.x;
          });

          if (!+val) {
            d3.selectAll("circle").filter(function (a) {
              return a.x === d.x;
            }).style("opacity", 1);
          }
          if (d3.select(e.target).attr("class") === "circle") {
            console.log(rData);
            console.log(e, d, i);
          }
        })
        .on("mouseout", function (e, d, i) {
          d3.selectAll("circle").style("opacity", 0);
          d3.select(".mouseover-line").remove();
        });

      var selection = d3.select("#chart");
      selection.datum(data.series).call(myChart);
  });
  </script>
</body>
</html>
